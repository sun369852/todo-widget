# Todo Widget — 项目文档

> Windows 桌面悬浮待办事项小组件
> 版本：0.1.0 | 最后更新：2026-02-26

---

## 一、项目简介

Todo Widget 是一款 Windows 桌面悬浮待办事项应用，采用 **Tauri 2.x** 框架构建。应用以小型悬浮球的形式常驻桌面，点击展开为完整的待办管理面板，支持增删改查、搜索过滤、优先级分类等功能。

---

## 二、技术栈

| 层级       | 技术                                      |
| ---------- | ----------------------------------------- |
| 桌面框架   | Tauri 2.x（Rust 后端）                    |
| 前端框架   | React 19 + TypeScript                     |
| 状态管理   | Zustand 5                                 |
| 样式       | Tailwind CSS 4 + 自定义 CSS（暗色主题）   |
| 数据库     | SQLite（通过 `tauri-plugin-sql`）          |
| 构建工具   | Vite 7                                    |
| 打包       | NSIS 安装包（Windows）                    |

---

## 三、项目结构

```
todo-widget/
├── src/                          # React 前端源码
│   ├── App.tsx                   # 主应用组件（待办列表 UI、搜索、过滤）
│   ├── App.css                   # 全局样式（暗色主题，含气泡窗口样式）
│   ├── main.tsx                  # React 入口
│   ├── store.ts                  # Zustand 状态管理（CRUD + 乐观更新）
│   ├── types.ts                  # TypeScript 类型定义（Todo / Category）
│   ├── components/
│   │   └── BubbleWindow.tsx      # 悬浮球组件（拖拽、点击切换、右键菜单）
│   └── services/
│       └── database.ts           # SQLite 数据库操作封装（建表 + CRUD）
├── src-tauri/                    # Rust / Tauri 后端
│   ├── src/
│   │   ├── lib.rs                # 应用启动逻辑：插件注册、窗口事件、托盘图标
│   │   └── main.rs               # 程序入口
│   ├── Cargo.toml                # Rust 依赖声明
│   ├── tauri.conf.json           # Tauri 配置（窗口属性、插件、打包）
│   ├── capabilities/             # 权限配置
│   └── icons/                    # 应用图标
├── package.json                  # 前端依赖与脚本
├── vite.config.ts                # Vite 构建配置
├── tsconfig.json                 # TypeScript 配置
└── plan.md                       # 功能需求说明
```

---

## 四、核心功能

### 4.1 双窗口模式

| 窗口     | 尺寸    | 说明                                                      |
| -------- | ------- | --------------------------------------------------------- |
| 气泡窗口 | 70×70   | 圆形悬浮球，始终置顶，点击展开主窗口，右键菜单可退出应用  |
| 主窗口   | 360×520 | 待办管理面板，无边框、透明背景、始终置顶、不显示在任务栏   |

切换逻辑：
- 点击气泡 → 隐藏气泡，显示主窗口
- 关闭主窗口 → 隐藏主窗口，显示气泡
- 托盘图标左键 → 切换主窗口显示/隐藏

### 4.2 待办事项管理

- **添加**：输入标题 + 选择优先级（低/中/高）
- **编辑**：修改标题和优先级
- **完成**：复选框切换完成状态（完成后显示删除线）
- **删除**：移除待办
- **搜索**：关键词实时过滤
- **状态过滤**：全部 / 进行中 / 已完成

### 4.3 数据持久化

使用 SQLite 数据库 `todo.db`，包含两张表：

```sql
-- 待办事项表
todos (id, title, completed, priority, category, due_date, created_at)

-- 分类表
categories (id, name, color)
```

状态管理采用 **乐观更新** 策略：UI 先行更新，数据库异步写入，失败后自动回滚。

### 4.4 系统集成

- **系统托盘**：左键切换窗口，右键菜单退出
- **窗口拖拽**：标题栏拖拽（主窗口）/ 整体拖拽（气泡窗口）
- **禁止文本选中**：避免拖拽时误选

---

## 五、Tauri 插件

| 插件                             | 用途              | 状态     |
| -------------------------------- | ----------------- | -------- |
| `tauri-plugin-sql`               | SQLite 数据库     | ✅ 已使用 |
| `tauri-plugin-global-shortcut`   | 全局快捷键        | ⚠️ 已注册，未实现具体功能 |
| `tauri-plugin-autostart`         | 开机自启          | ⚠️ 已注册，未实现具体功能 |
| `tauri-plugin-store`             | 键值持久化存储    | ⚠️ 已注册，未实现具体功能 |

---

## 六、窗口配置

```json
{
  "主窗口": {
    "尺寸": "360×520（最小 320×400）",
    "无边框": true,
    "透明背景": true,
    "始终置顶": true,
    "跳过任务栏": true,
    "可调整大小": false,
    "初始不可见": true
  },
  "气泡窗口": {
    "尺寸": "70×70",
    "初始位置": "(1200, 500)",
    "初始可见": true
  }
}
```

---

## 七、开发命令

```bash
# 安装依赖
npm install

# 启动开发模式（含 Tauri 桌面窗口）
npm run tauri dev

# 仅启动前端开发服务器（端口 1421）
npm run dev

# 生产构建
npm run tauri build
```

---

## 八、已知问题

- 项目路径不能包含中文字符，否则 Rust 编译可能失败

---

## 九、待完善功能

- [ ] 分类管理 UI（数据层已就绪，前端未接入）
- [ ] 全局快捷键绑定（插件已注册）
- [ ] 开机自启设置界面（插件已注册）
- [ ] 键值存储功能集成（如保存窗口位置等）
- [ ] 截止日期 (due_date) 相关 UI
